# 🗑️ LLM 쓰레기 분류 시스템

Gemini API를 활용한 이미지 기반 쓰레기 분류 프로토타입

## 📊 테스트 결과

### 최종 성능 (프롬프트 개선 후)
| 쓰레기 종류 | 종류 판단 | 오염도 판단 | 추가 처리 안내 |
|------------|----------|------------|--------------|
| 플라스틱 용기 | ✅ 정확 | 0% (완벽) | 하단 부착물 분리 안내 |
| 유리병 | ✅ 정확 | 10% (개선!) | 라벨 분리 안내 |
| 캔 | ✅ 정확 | 5% (개선!) | - |
| 비닐 | ✅ 정확 | 0% (완벽) | - |

**정확도:**
- 분리수거 대상 판단: **100%**
- 종류 분류: **100%** (4/4)
- 상태 판단: **크게 개선** (과잉 판단 해결)

## 🎯 주요 기능

### 1. 3단계 쓰레기 분류
- ✅ 분리수거 vs 일반쓰레기 판단
- ✅ 세부 종류 분류 (플라스틱/유리/종이/비닐/캔)
- ✅ 확신도 기반 상태 판단

### 2. 오염도 기반 처리 판단
```
오염 확신도 50% 이상    → 세척필요
오염 확신도 15-50%      → 확인 및 세척권장
오염 확신도 15% 미만    → 가능
```

### 3. 추가 처리 안내
- 라벨/뚜껑 분리 필요 여부
- 전처리 방법 안내

## 🚀 빠른 시작

### 1. 레포 클론
```bash
git clone [레포_주소]
cd waste_llm
```

### 2. 라이브러리 설치
```bash
py -m pip install -r requirements.txt
```

### 3. API 키 설정
1. `.env.example` 파일을 `.env`로 복사
2. [Google AI Studio](https://aistudio.google.com/app/apikey)에서 API 키 발급
3. `.env` 파일에 본인의 API 키 입력

### 4. 이미지 준비
- 쓰레기 사진을 `waste_LLM_test` 폴더에 저장
- 파일명: `test_plastic.jpg`, `test_can.jpg` 등

### 5. 실행
```bash
py test_classifier.py
```

코드에서 `image_path` 변수를 실제 파일명으로 수정 후 실행하세요.

## 📁 프로젝트 구조
```
waste_llm/
├── test_classifier.py    # 메인 분류 코드
├── test_gemini_api.py    # API 연결 테스트
├── .env                  # API 키 (Git 제외)
├── .env.example          # API 키 예시
├── requirements.txt      # 라이브러리 목록
├── test_*.jpg            # 테스트 이미지들
└── README.md            # 이 파일
```

## 🛠️ 사용 기술

### AI/ML
- **Google Gemini 2.5 Flash** - 이미지 분석 및 분류
- **프롬프트 엔지니어링** - 확신도 기반 판단 시스템

### 라이브러리
- `google-genai` (0.8.6) - Gemini API 클라이언트
- `pillow` (12.1.0) - 이미지 처리
- `python-dotenv` (1.2.1) - 환경변수 관리

### 개발 환경
- Python 3.14
- PyCharm IDE

## 💡 프롬프트 엔지니어링 핵심

### 문제점 발견 및 개선
**초기 문제:**
- 깨끗한 쓰레기도 "세척 필요"로 과잉 판단
- 라벨/띠지를 오염물로 오인
- 캔의 디자인을 잔여물로 착각

**해결 방법:**
1. 명확한 판단 기준 제시 (확신도 수치화)
2. "라벨은 오염물이 아님" 명시
3. "캔의 그래픽은 정상" 규칙 추가
4. 3단계 판단 시스템 도입

## 📈 개선 과정

### Before (초기 버전)
- 오염도 판단 정확도: 0% (전부 세척 필요로 판단)
- 유리병 오염도: 80%
- 캔 오염도: 50%

### After (프롬프트 개선)
- 오염도 판단 정확도: 크게 개선
- 유리병 오염도: 10% ✅
- 캔 오염도: 5% ✅
- 플라스틱 오염도: 0% ✅

## ⚠️ 제한사항 및 고려사항

### 현재 한계
- 통제된 실내 환경(양호한 조명) 전용
- 쓰레기 1개씩 개별 촬영 필요
- **무료 API 사용량 제한:**
  - **Gemini 2.5 Flash: 20회/일** ← 현재 사용 중
  - Gemini 2.0 Flash: 1,500회/일 (대안)
  - 쿼터 초과 시 해결법:
    1. 코드에서 모델을 `gemini-2.0-flash`로 변경
    2. 새 API 키 발급 (https://aistudio.google.com/app/apikey)
    3. 다음 날 자정(UTC) 대기 (한국 시간 오전 9시)

### 실제 환경 적용 시 개선 필요사항
1. **하드웨어 개선**
   - 컨베이어 벨트 시스템
   - 상/하부 조명 설치
   - 다각도 카메라 구성

2. **소프트웨어 개선**
   - 여러 프레임 종합 판단
   - 불확실한 경우 재촬영 요청
   - 로봇 제어 시스템 통합

3. **확장 가능성**
   - 뎁스 카메라 연동
   - 두산 협동로봇 통합
   - 실시간 분류 시스템

## 🎓 학습 포인트

### 기술적 학습
- LLM API 연동 및 활용
- 프롬프트 엔지니어링의 중요성
- 이미지 기반 AI 분류 시스템

### 문제 해결
- 과잉 판단 문제 해결 (확신도 기반)
- 라벨/디자인 오인식 해결
- API 사용량 관리

## 📝 개발 일지

**2025년 1월 4일 (토) 밤~5일 (일) 새벽**
- 환경 설정 및 API 연동
- 기본 이미지 분류 시스템 구축
- 4가지 쓰레기 테스트
- 프롬프트 개선 (3회 반복)
- 최종 정확도 향상 확인

**총 개발 시간:** 약 2시간

## 📚 참고 자료

- [Google Gemini API 문서](https://ai.google.dev/)
- [Python-dotenv](https://pypi.org/project/python-dotenv/)
- [Pillow 문서](https://pillow.readthedocs.io/)
- [프롬프트 엔지니어링 가이드](https://www.promptingguide.ai/)
